<style>
    #map {
        border: 3px solid #000;
        width: 100%;
        height: 400px;
    }
    .leaflet-popup-content {
        width:auto !important;
        height:auto !important;
    }
</style>

<div id='map'>
    <script>
        var map;
        <% if @sensors.size > 0 %>
            map = L.map('map').setView([<%=@sensors[0].latitude%>, <%=@sensors[0].longitude%>], 13);
        <% else %>
            map = L.map('map').setView([<%="44.83377627198407,11.598755176671702"%>], 13);
        <% end %>

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        var resizeObserver = new ResizeObserver(() => {
            map.invalidateSize();
        });
        var mapDiv = document.getElementById("map")
        resizeObserver.observe(mapDiv);

        var mark = [];
        var popup;

        <% @sensors.each_with_index do |sensor,i| %>
         popup = new L.Popup();
         mark.push(L.marker([<%=sensor.latitude%>, <%=sensor.longitude%>]).addTo(map))
         popup.setContent('<%=sensor.URI%>');
         mark[<%=i%>].bindPopup(popup);
        <% end %>
    </script>
</div>